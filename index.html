<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        
        <div class="stat">
            <div id="gpm"></div>
            <div id="xpm"></div>
            <div id="kill-streak"></div>
            <div id="kill-list"></div>
            <div id="xpos"></div>
            <div id="ypos"></div>
        </div>
    </main>

    <pre id="json-data" class="data"></pre>

    <audio id="music" src="./data/fp_am.mp3" muted></audio>
    <h1></h1>
    <video id="video" muted src="./data/you_died.mp4" style="display: none;">
        Ваш браузер не поддерживает видео.
    </video>

        

    <script>
        const { ipcRenderer } = require('electron');
        const gpmData = document.getElementById('gpm');
        const xpmData = document.getElementById('xpm');
        const killStreakData = document.getElementById('kill-streak');
        const killListData = document.getElementById('kill-list');
        const xposData = document.getElementById('xpos');
        const yposData = document.getElementById('ypos');

        const music = document.getElementById('music');
        const video = document.getElementById('video');
        const jsonDataElement = document.getElementById('json-data');

        let isVideoPlayed = false;
        let isMusicPlayed = false;

        

        ipcRenderer.on('json-data', (event, data) => {
            jsonDataElement.textContent = JSON.stringify(data, null, 2);
            gpmValue = data.player.gpm;         
            gpmData.textContent = "gpm " + gpmValue; 
            xpmValue = data.player.xpm;
            xpmData.textContent = "xpm " + xpmValue;
            killStreakValue = data.player.kill_streak;
            killStreakData.textContent = "kill streak " + killStreakValue;
            const killListValue = data.player.kill_list;
            let killListOutput = "kill list:<br>";
            for (const key in killListValue){
                if(killListValue.hasOwnProperty(key)){
                    killListOutput += `  ${key}: ${killListValue[key]}<br>`;
                }
            }
            killListData.innerHTML = killListOutput;
            xposData.textContent = "xpos " + data.hero.xpos;
            yposData.textContent = "ypos" + data.hero.ypos;
        });

        ipcRenderer.on('died', (event, data) => {
            isVideoPlayed = true;   
            if(isVideoPlayed){
                video.style.display = 'block';
                video.muted = false;
                video.play().catch(error => {
                console.error('Ошибка воспроизведения видео:', error);
            });
            }
            isVideoPlayed = false;
            video.addEventListener('ended', () => {
                video.style.display = 'none';
            });
        });

        ipcRenderer.on('radik', (event, data) => {
            if(!isMusicPlayed){
                music.muted = false;
                music.play().catch(error => {
                console.error('Ошибка воспроизведения музыки:', error);
                });
                isMusicPlayed = true;
            }
        });
    </script>
</body>
</html>